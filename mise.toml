[tools]
deno = "2.6.3"
"npm:@fission-ai/openspec" = "0.18.0"

[tasks.check]
run = [
  { task = "check:format" },
  { task = "check:type" },
  { task = "check:lint" },
]

[tasks."check:format"]
usage = 'arg "[FILES]"'
run = "deno fmt --check ${usage_files}"

[tasks."check:type"]
usage = 'arg "[FILES]"'
run = "deno check ${usage_files}"

[tasks."check:lint"]
usage = 'arg "[FILES]"'
run = "deno lint ${usage_files}"

[tasks.fix]
usage = 'arg "[FILES]"'
run = ["deno fmt ${usage_files}", "deno lint --fix ${usage_files}"]

[tasks.test]
usage = 'arg "[FILES]"'
run = "deno test ${usage_files}"

[tasks.build]
usage = '''
arg "<VERSION>" env="BUILD_VERSION"
arg "<PLATFORM>" env="BUILD_PLATFORM"
'''
run = [
  "mise run internal:build -- ${usage_version:?} ${usage_platform:?} src/cli/chroma.ts",
  "mise run internal:build -- ${usage_version:?} ${usage_platform:?} src/cli/chromad.ts",
]

[tasks."gha:lint"]
tools.actionlint = "1.7.10"
tools.ghalint = "1.5.4"
run = ["actionlint", "ghalint act"]
