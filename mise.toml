experimental_monorepo_root = true
monorepo.config_roots = ["packages/*"]

[settings]
lockfile = true
task_show_full_cmd = true

[tools]
bun = "1.3.6"
lefthook = "2.0.15"

[hooks]
postinstall = "lefthook install"

[tasks."gha:lint"]
tools.actionlint = "1.7.10"
tools.ghalint = "1.5.4"
run = ["actionlint", "ghalint act"]

[tasks.dist]
usage = 'arg "<archive_name>"'
run = [
  "mkdir -p dist/${usage_archive_name:?}/bin",
  "cp LICENSE dist/${usage_archive_name:?}/",
  "cp -r packages/server/build/* packages/client/build/* dist/${usage_archive_name:?}/bin/",
  "(cd dist && tar czvf ${usage_archive_name:?}.tar.gz ${usage_archive_name:?})",
  "rm -r dist/${usage_archive_name:?}",
]

[task_templates.check]
usage = 'arg "[files]" var=#true'
run = [
  "bunx --bun tsc",
  "bunx --bun biome check --error-on-warnings ${usage_files}",
]

[task_templates.fix]
usage = 'arg "[files]" var=#true'
run = "bunx --bun biome check --write ${usage_files}"

[task_templates.test]
usage = 'arg "[files]" var=#true'
run = "bunx --bun vitest run ${usage_files}"
