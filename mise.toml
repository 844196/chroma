experimental_monorepo_root = true
monorepo.config_roots = ["packages/*"]

[settings]
lockfile = true
task_show_full_cmd = true

[tools]
bun = "1.3.9"
lefthook = "2.0.15"

[hooks]
postinstall = "lefthook install"

[tasks."gha:lint"]
tools.actionlint = "1.7.10"
tools.ghalint = "1.5.4"
run = ["actionlint", "ghalint act"]

[tasks.dist]
usage = 'arg "<archive_name>"'
run = [
  "mkdir -p dist/${usage_archive_name:?}",
  "cp LICENSE dist/${usage_archive_name:?}/",
  "cp -r packages/*/dist/* dist/${usage_archive_name:?}/",
  "(cd dist && tar czvf ${usage_archive_name:?}.tar.gz ${usage_archive_name:?})",
  "rm -r dist/${usage_archive_name:?}",
]

[task_templates.check]
usage = 'arg "[files]" var=#true'
run = '''
#!/usr/bin/env bash
eval "files=($usage_files)"
bunx --bun tsc
bunx --bun biome check --error-on-warnings "${files[@]}"
'''

[task_templates.fix]
usage = 'arg "[files]" var=#true'
run = '''
#!/usr/bin/env bash
eval "files=($usage_files)"
bunx --bun biome check --write "${files[@]}"
'''

[task_templates.test]
# NOTE: ファイルパスだけでなくVitestのオプションも受け取れるようにするため、usageを使用しない
run = 'bunx --bun vitest run "$@"'
